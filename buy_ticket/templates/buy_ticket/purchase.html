{% extends 'ticket_exchange/base.html' %}
{% load static %}

{% block scripts %}
    <script src="https://js.braintreegateway.com/js/braintree-2.20.0.js"></script>
    <script src="{% static 'buy_ticket/js/count_down_timer.js' %}"></script>
    <script src="{% static 'buy_ticket/js/braintree.js' %}"></script>
    <script>document.onload = start_count_down_timer({{ time_left }}, {{ ticket.event.id }})</script>
{#    <script>document.onload = setupBraintreeAjax()</script>#}
    <script>document.onload = setupBraintree('{{ token }}')</script>
{% endblock %}


{% block stylesheets %}
    <link rel="stylesheet" href="{% static 'buy_ticket/css/stylesheet.css' %}">
{% endblock %}


{% block content %}

    <div>
        <h2>Event</h2>
        <p>Event: {{ ticket.event.name }}</p>
        <p>When: {{ ticket.event.start_date }} - {{ ticket.event.end_date }}</p>
        <p>Where: {{ ticket.event.location }}, {{ ticket.event.city }}, {{ ticket.event.country }}</p>
    </div>

    <div>
        <h2>Personal Details</h2>
        <p>Name: {{ user.person.fullname }}</p>
        <p>Email: {{ user.email }}</p>
    </div>


    <div>
        <h2>Cost:</h2>
        <p>Ticket Price {{ ticket.price }}</p>
        <p>Commission: {{ ticket_price_object.commission }}</p>
        <p>Bank costs: {{ ticket_price_object.bank_costs }}</p>
        <p>Total Price: {{ ticket_price_object.total_price }}</p>
    </div>

    <div id="count-down-timer">
        <p>Time left:</p>
    </div>

    <form method="POST">{% csrf_token %}
        <div id="dropin-container"></div>
        <a class="btn btn-default" href="{% url 'buy_ticket:cancel_ticket_view' ticket.id %}">Cancel</a>
        <button class="btn btn-primary" type="submit">Purchase</button>
    </form>

{% endblock %}